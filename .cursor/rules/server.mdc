---
description: "הנחיות מותאמות לשרת NestJS במונורפו EveryTriv"
globs:
  - server/**\/*.ts
alwaysApply: false
---

# הוראות NestJS מותאמות לפרויקט

## מבנה פרויקט
- כל קוד המקור חייב לשבת תחת `server/src`.
- ארגון לפי מאפיינים: `features/`, `shared/`, `config/`, `constants/`.
- כל מודול מאפיין כולל `controllers`, `services`, `dtos`, `entities`, `types`, ו-`{feature}.module.ts`.
- קוד משותף נמצא בתיקיית המונורפו `shared/` ומשותף באמצעות barrel `index.ts`.

## TypeScript
- `tsconfig` מוגדר עם `"strict": true`; אין לשחרר את ההגדרה.
- אין להשתמש ב-`any`, `unknown`, או `as`; נדרשים טיפוסים ספציפיים ושומרי טיפוס.
- לחתום כל פונקציה בפרמטרים ובערכי החזרה מפורשים.
- טיפוסים משותפים חיים תחת `shared/types/<domain>` ומיובאים משם בלבד.

## API ועיצוב שכבות
- הבקרים (`controllers`) דקים ומכילים רק טיפול בנתיב, ואלידציה ומיפוי DTO.
- כל לוגיקה עסקית נכתבת בשירותים (`services`) עם הזרקת תלות.
- DTO מוגדרים ב-`dtos/` עם `class-validator` ו-`class-transformer`.
- תיעוד Swagger חובה עבור נתיבים ציבוריים.

## לוגים וקבועים
- כל הלוגיקה של לוגים רוכזת בשירותים או שירות לוג ייעודי כדי למנוע כפילות.
- קבועים נשמרים ב-`shared/constants/<domain>` ומיוצאים דרך `shared/constants/index.ts`.
- אין להשתמש ב-console; רק שירות לוגים.

## כלים ותזרים עבודה
- שימוש ב-`pnpm` בלבד. פקודות PowerShell נרצות ללא `&&`.
- לעדכן barrel exports בעת הוספת קבצים ב-`shared/`.
- אסור להוסיף קוד דוגמה או Placeholder.
- כל פונקציה חדשה חייבת מימוש מלא ושימוש ישיר.

## בדיקות
- שירותים ובקרים מקבלים בדיקות יחידה עם Jest ו-`@nestjs/testing`.
- Mock לכל תלות דרך מנגנון ההזרקה של Nest.
- מבחני e2e נשמרים תחת `server/test`.

## סגנון וקונבנציות
- שמות קבצים camelCase; מחלקות וממשקים PascalCase.
- להוסיף JSDoc לממשקי API ציבוריים.
- ייבוא תמיד דרך barrels (`index.ts`) כאשר קיים.
- לממש טיפוסים ייעודיים עבור תוצאות, שגיאות ופרמטרים; אין טיפוסים גנריים.
